<div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title">{{title}}</h5>
    <button type="button" class="close" (click)="fecharModal()" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngIf="etapa === 'calendario'">
      <div style="text-align: center;">
        <bs-datepicker-inline [bsValue]="bsValue" [bsConfig]="{ containerClass: 'theme-blue' }"
          (bsValueChange)="onDateSelected($event)"></bs-datepicker-inline>
      </div>
      <br>
      <div *ngIf="horariosDisponiveis.length > 0">
        <h5>Escolha um horário: </h5>
      </div>
      <div *ngIf="horariosDisponiveis.length <= 0">
        <h5>Nenhum horário disponível.</h5>
      </div>
      <div class="d-flex flex-wrap">
        <button type="button" *ngFor="let horario of horariosDisponiveis"
          class="btn btn-primary d-inline-block mx-2 my-2"
          [class.btn-secondary]="agendamento.horarioMarcado !== horario" (click)="agendamento.horarioMarcado = horario">
          {{ horario }}
        </button>
      </div>
    </div>

    <form [formGroup]="formCliente">

      <div *ngIf="etapa === 'telefone'">
        <input id="telefone" placeholder="Número de WhatsApp:" [(ngModel)]="agendamento.cliente.telefone"
        formControlName="telefone" mask="(00) 00000-0000"
        [ngClass]="{'is-invalid': controlsCliente.telefone.errors && controlsCliente.telefone.touched }">
        <div *ngIf="controlsCliente.telefone.errors?.required" class="invalid-feedback mensagemErro">
          Telefone é obrigatório.
        </div>
        <div *ngIf="controlsCliente.telefone.errors?.minlength" class="invalid-feedback mensagemErro">
          Telefone deve ter no mínimo 11 caracteres.
        </div>
      </div>

      <div *ngIf="etapa === 'cliente'">
        <div>
          <input type="text" id="nome" placeholder="Nome:" [(ngModel)]="agendamento.cliente.nome"
            [ngClass]="{'is-invalid': controlsCliente.nome.errors && controlsCliente.nome.touched }"
            formControlName="nome">
          <div *ngIf="controlsCliente.nome.errors?.required" class="invalid-feedback mensagemErro">
            Nome é obrigatório.
          </div>
          <div *ngIf="controlsCliente.nome.errors?.minlength" class="invalid-feedback mensagemErro">
            Nome deve ter no mínimo 3 caracteres.
          </div>
          <div *ngIf="controlsCliente.nome.errors?.maxlength" class="invalid-feedback mensagemErro">
            Nome deve ter no máximo 50 caracteres.
          </div>
        </div>

        <div>
          <input type="text" id="endereco" placeholder="Endereço do cliente:" [(ngModel)]="agendamento.cliente.endereco"
            formControlName="endereco"
            [ngClass]="{'is-invalid': controlsCliente.endereco.errors && controlsCliente.endereco.touched }">
          <div *ngIf="controlsCliente.endereco.errors?.maxlength" class="invalid-feedback mensagemErro">
            Endereço deve ter no máximo 100 caracteres.
          </div>
        </div>

        <div>
          <input type="text" id="complemento" placeholder="Complemento do endereço:"
            [(ngModel)]="agendamento.cliente.complemento" formControlName="complemento"
            [ngClass]="{'is-invalid': controlsCliente.complemento.errors && controlsCliente.complemento.touched }">
          <div *ngIf="controlsCliente.complemento.errors?.maxlength" class="invalid-feedback mensagemErro">
            Complemento deve ter no máximo 130 caracteres.
          </div>
        </div>
      </div>
    </form>
    <div *ngIf="etapa === 'agendamento'">
      <h5>Cliente:</h5>
      <li>Nome: {{agendamento.cliente.nome}} </li>
      <li>Telefone: {{agendamento.cliente.telefone | TelefoneFormat}}</li>
      <li>Endereço: {{agendamento.cliente.endereco}}</li>
      <li>Complemento: {{agendamento.cliente.complemento}}</li>

      <br>
      <h5>Serviço:</h5>
      <li>Nome: {{agendamento.servico.nome}}</li>
      <li>Preço: R$ {{ agendamento.servico.preco.toFixed(2) }}</li>
      <li>Descrição: {{agendamento.servico.descricao}}</li>

      <br>
      <h5>Data Agendamento:</h5>

      <h5>Horário:</h5>
      <li>Data agendada: {{agendamento.dataAgendamento | DateTimeFormat}}</li>
      <li>Horário selecionado: {{agendamento.horarioMarcado}}</li>

    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="voltar()">Voltar</button>
    <button type="button" *ngIf="etapa != 'agendamento'" class="btn btn-primary" [disabled]="avancarDisabled()"
      (click)="avancar()">
      Avançar <i class="fa-solid fa-arrow-right my-1"></i>
    </button>

    <button type="button" *ngIf="etapa === 'agendamento'" class="btn btn-success" [disabled]="formCliente.invalid"
      data-dismiss="modal" (click)="adicionarAgendamento()">Realizar
      Agendamento</button>
  </div>
</div>
